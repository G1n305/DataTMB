<!DOCTYPE html>
<html>
<head>
    <title>Biểu Đồ Chứng Khoán</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <div class="input-form">
        <label for="year">Năm:</label>
        <!-- Năm -->
<div class="dropdown">
    <button class="dropbtn">Chọn Năm</button>
    <div class="dropdown-content" id="yearDropdown">
        <label><input type="checkbox" value="all" onchange="checkAll(this, 'year')"> All</label>
        <!-- Lặp để tạo các checkboxes cho mỗi năm từ 2009 đến năm hiện tại -->
        <script>
            var currentYear = new Date().getFullYear();
            for (var i = 2009; i <= currentYear; i++) {
                document.write('<label><input type="checkbox" name="year" value="' + i + '"> ' + i + '</label>');
            }
        </script>
    </div>
</div>

        <select id="year" name="year" multiple>
            <option value="all">All</option>
            <!-- Lặp từ 2009 đến năm hiện tại -->
            <script>
                var currentYear = new Date().getFullYear();
                for (var i = 2009; i <= currentYear; i++) {
                    document.write('<option value="' + i + '">' + i + '</option>');
                }
            </script>
        </select>

        <label for="quarter">Quý:</label>
        <!-- Quý -->
<div class="dropdown">
    <button class="dropbtn">Chọn Quý</button>
    <div class="dropdown-content" id="quarterDropdown">
        <label><input type="checkbox" value="all" onchange="checkAll(this, 'quarter')"> All</label>
        <label><input type="checkbox" name="quarter" value="1"> Q1</label>
        <label><input type="checkbox" name="quarter" value="2"> Q2</label>
        <label><input type="checkbox" name="quarter" value="3"> Q3</label>
        <label><input type="checkbox" name="quarter" value="4"> Q4</label>
    </div>
</div>
        <select id="quarter" name="quarter" multiple>
            <option value="all">All</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </select>

        <label for="stockCode">Mã Chứng Khoán:</label>
        <input type="text" id="stockCode" name="stockCode" placeholder="VCB,BID,...">

        <button onclick="drawChart()">Vẽ Biểu Đồ</button>
    </div>

    <div id="chartContainer">
        <!-- Nơi hiển thị biểu đồ -->
        <img id="chartImage" src="" alt="Biểu đồ chứng khoán" style="display: none;" />
    </div>
<script>
    function drawChart() {
        // Lấy tất cả giá trị được chọn từ select box năm và quý
        var yearSelect = document.getElementById('year');
        var quarterSelect = document.getElementById('quarter');
        var years = Array.from(yearSelect.selectedOptions).map(option => option.value);
        var quarters = Array.from(quarterSelect.selectedOptions).map(option => option.value);
        var stockCode = document.getElementById('stockCode').value;
    
        // Kiểm tra nếu lựa chọn là 'all', thì lấy tất cả các giá trị
        years = years.includes('all') ? Array.from(yearSelect.options).filter(option => option.value !== 'all').map(option => option.value) : years;
        quarters = quarters.includes('all') ? [1, 2, 3, 4] : quarters;
    
        fetch('/draw_chart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                'year': years,
                'quarter': quarters,
                'stockCode': stockCode
            })
        })
        .then(response => response.blob())
            .then(blob => {
                var url = URL.createObjectURL(blob);
                document.getElementById('chartImage').src = url;
                document.getElementById('chartImage').style.display = 'block';
            })
            return false;
    }
</script>
<script>function checkAll(source, name) {
    checkboxes = document.getElementsByName(name);
    for (var i = 0, n = checkboxes.length; i < n; i++) {
        checkboxes[i].checked = source.checked;
    }
}
</script>
</body>
</html>